#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."
echo ""

# Run linting on staged files
echo "ğŸ“ Linting staged files..."
npx lint-staged
if [ $? -ne 0 ]; then
  echo "âŒ Linting failed! Please fix errors before committing."
  exit 1
fi
echo "âœ… Linting passed"
echo ""

# Run backend tests
echo "ğŸ§ª Running backend tests (172 tests)..."
npm run test:unit --silent
if [ $? -ne 0 ]; then
  echo "âŒ Backend tests failed! Please fix failing tests before committing."
  echo "   Run 'npm run test:unit' to see details"
  exit 1
fi
echo "âœ… Backend tests passed (172/172)"
echo ""

# Run frontend tests
echo "ğŸ¨ Running frontend tests (177 tests)..."
cd public/dashboard-app && npm test -- --run --silent
if [ $? -ne 0 ]; then
  echo "âŒ Frontend tests failed! Please fix failing tests before committing."
  echo "   Run 'npm run test:frontend' to see details"
  exit 1
fi
cd ../..
echo "âœ… Frontend tests passed (177/177)"
echo ""

echo "âœ… All pre-commit checks passed! (349/349 tests)"
echo "ğŸš€ Safe to commit!"
echo ""